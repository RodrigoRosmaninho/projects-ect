<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Stock Check</title>
    <link href="/webjars/bootstrap/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <h1>Stock Real-time prices</h1>
    <div class="autocomplete" style="width:55%;">
        <h4>Search Bar</h4>
        <input id="myInput" type="text" onkeyup="myFunction()" name="company_name" placeholder="search for a company name ...">
        <br/><br/>
        <br/><br/>
        <br/><br/>
    </div>

    <ul id="myUL" style="list-style-type: none;">
    <li name='default' style="display: none;">
        <article>
            <header>
                <h2>No matches found</h2>
            </header><!-- .entry-header -->
        </article><!-- #post-## -->
    </li>

    <li th:each="company : ${companies}" th:attr="name=${company.getName()}" >
        <article>
            <header>
                <h2 th:text="${company.getName()}"></h2>
                <div>
                    <span>Current Value: </span><span th:text="${company.getCurrent()}"></span><br/>
                    <span>First Exchange of the Day Value: </span><span th:text="${company.getOpen()}"></span><br/>
                    <span>Max Value: </span><span th:text="${company.getHigh()}"></span><br/>
                    <span>Min Value: </span><span th:text="${company.getLow()}"></span><br/>
                </div><!-- .entry-meta -->
            </header><!-- .entry-header -->
            <hr>
        </article><!-- #post-## -->
    </li>
    </ul>

    <script src="/webjars/jquery/jquery.min.js"></script>
    <script src="/webjars/sockjs-client/sockjs.min.js"></script>
    <script src="/webjars/stomp-websocket/stomp.min.js"></script>
    <script>
        var socket = new SockJS('/stock-check-websocket');
        stompClient = Stomp.over(socket);
        stompClient.connect({}, function (frame) {
            console.log('Connected: ' + frame);
            stompClient.subscribe('/topic/quotes', function (quote) {
                console.log(JSON.parse(quote.body));
            });
        });

        function myFunction() {
            var input, filter, ul, li, a, i, txtValue;
            input = document.getElementById("myInput");
            filter = input.value.toUpperCase();
            ul = document.getElementById("myUL");
            li = ul.getElementsByTagName("li");

            var count = 0;
            for (i = 0; i < li.length; i++) {
                txtValue = li[i].getAttribute("name");
                if (txtValue.toUpperCase().indexOf(filter) > -1) {
                    li[i].style.display = "";
                } else {
                    li[i].style.display = "none";
                    count++;
                }
            }
            if (count == li.length){
                li[0].style.display = "";
            }
            else{
                li[0].style.display = "none";
            }
        }
    </script>
</body>
</html>